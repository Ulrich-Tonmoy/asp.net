@page "/leaverequests/details/{id}"
<h3>Details</h3>


<div class="alert alert-@ClassName" role="alert">
    <h4 class="alert-heading">@HeadingText</h4>
    <p>
        @* <strong>Employee name:</strong> @Model.Employee.Firstname @Model.Employee.Lastname <br /> *@
    </p>
    <hr />
    <p>
        Date Requested - @Model?.DateRequested
    </p>
</div>


<div>

    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            Start Date
        </dt>
        <dd class="col-sm-10">
            @Model.StartDate
        </dd>
        <dt class="col-sm-2">
            End Date
        </dt>
        <dd class="col-sm-10">
            @Model.EndDate
        </dd>
        <dt class="col-sm-2">
            Leave Type
        </dt>
        <dd class="col-sm-10">
            @Model?.LeaveType?.Name
        </dd>
        <dt class="col-sm-2">
            Request Comments
        </dt>
        <dd class="col-sm-10">
            @Model?.RequestComments
        </dd>
    </dl>
</div>
<div>

    @if (Model.Approved == null)
    {
        <button class="btn btn-success" @onclick="(() => ChangeApproval(true))">
            Approve
        </button>
        <button class="btn btn-danger me-2" @onclick="(() => ChangeApproval(false))">
            Reject
        </button>
    }
    <BackToList Target="leaverequests/" />

</div>

@code {
    [Inject] ILeaveRequestService leaveRequestService { get; set; }
    [Inject] NavigationManager navigationManager { get; set; }
    [Parameter] public string id { get; set; }

    string ClassName;
    string HeadingText;

    public LeaveRequestDto Model { get; private set; } = new LeaveRequestDto();

    protected override async Task OnParametersSetAsync()
    {
        Model = await leaveRequestService.GetLeaveRequestById(new Guid(id));

        if (Model.Approved == null)
        {
            ClassName = "warning";
            HeadingText = "Pending Approval";
        }
        else if (Model.Approved == true)
        {
            ClassName = "success";
            HeadingText = "Approved";
        }
        else
        {
            ClassName = "danger";
            HeadingText = "Rejected";
        }
    }

    protected override async Task OnInitializedAsync()
    {
        
    }

    async Task ChangeApproval(bool approvalStatus)
    {
        if (approvalStatus) Model.Approved = true;
        else Model.Approved = false;
        await leaveRequestService.UpdateLeaveRequest(Model);
        navigationManager.NavigateTo("/leaverequests");
    }
}
